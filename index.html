<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quantum Jumper - Phaser 3</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #222;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: monospace;
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }

        #game-container {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100vw;
            height: 100vh;
        }

        .instructions {
            color: white;
            text-align: center;
            font-size: clamp(10px, 2.5vw, 14px);
            margin-bottom: 10px;
            padding: 0 10px;
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
        }

        #mobile-controls {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 999;
            pointer-events: none;
        }

        @media (max-width: 768px) {
            #mobile-controls {
                display: block;
            }

            .instructions {
                display: none;
            }

            body {
                padding: 10px;
            }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/3.70.0/phaser.min.js"></script>
</head>

<body>
    <div id="game-container">
        <div class="instructions">
            Arrow keys or WASD to move, Space to shift dimensions<br />
            Reach the green portal to advance to the next level!<br />
            <small>üçø Snacks provided during hackathon (no meals)</small>
        </div>
        <div id="mobile-controls" style="display: none;"></div>
    </div>
    <script>
        /**
         * Quantum Jumper - Hackathon Rookie Kit
         *
         * Welcome! This code is designed for absolute beginners.
         * Every function and variable is named for clarity.
         * You can change things and see what happens!
         *
         * ---
         * HOW TO MOD:
         * - Change colors, platform positions, or player speed by editing constants.
         * - Add new features by copying and tweaking small functions.
         * - Read the comments! They explain what each part does.
         * ---
         */

        // === GAME CONSTANTS ===
        const GAME_WIDTH = 800;
        const GAME_HEIGHT = 400;
        const WORLD_WIDTH = GAME_WIDTH * 3;
        const PLAYER_SPEED = 160;
        const JUMP_VELOCITY = 400;
        const GRAVITY = 600;
        const PLATFORM_WIDTH = 16;
        const PLATFORM_HEIGHT = 16;
        const PLAYER_START_X = 50;
        const PLAYER_START_Y = 200;

        // === MAIN GAME SCENE ===
        class QuantumJumper extends Phaser.Scene {
            constructor() {
                super({ key: "GameScene" });
            }

            preload() {
                this.createTextures();
            }

            create() {
                // --- Game State ---
                this.level = 1;
                this.score = 0;
                this.lives = 3;
                this.dimension = 0; // 0 = light, 1 = dark
                this.levelTransitioning = false;
                this.speedBoostActive = false;
                this.jumpBoostActive = false;
                this.currentPlayerSpeed = PLAYER_SPEED;
                this.currentJumpVelocity = JUMP_VELOCITY;

                this.setupAudio();
                this.setupPhysicsWorld();
                this.createBackground();
                this.createPlayer();
                this.createGroups();
                this.createParticles();
                this.createUI();
                // Initialize mobile input state for touch controls
                this.mobileInput = { left: false, right: false };
                this.setupInput();
                this.generateLevel();
                this.setupCamera();
            }

            // === TEXTURE CREATION ===
            createTextures() {
                // Player texture - white square with a simple face
                const playerLight = this.add.graphics();
                playerLight.fillStyle(0xffffff);
                playerLight.fillRect(0, 0, 16, 16);
                // Add simple face - two eyes and a mouth
                playerLight.fillStyle(0x000000);
                playerLight.fillRect(4, 4, 2, 2); // Left eye
                playerLight.fillRect(10, 4, 2, 2); // Right eye
                playerLight.fillRect(5, 10, 6, 1); // Mouth
                playerLight.generateTexture("player_light", 16, 16);
                playerLight.destroy();

                // Platform texture - green square
                const platformLight = this.add.graphics();
                platformLight.fillStyle(0x90ee90);
                platformLight.fillRect(0, 0, 16, 16);
                platformLight.generateTexture("platform_light", 16, 16);
                platformLight.destroy();

                // Coin texture - golden circle
                const coin = this.add.graphics();
                coin.fillStyle(0xffd700);
                coin.fillCircle(8, 8, 6);
                coin.fillStyle(0xffff00);
                coin.fillCircle(8, 8, 4);
                coin.generateTexture("coin", 16, 16);
                coin.destroy();

                // Powerup texture - purple square with sparkles
                const powerup = this.add.graphics();
                powerup.fillStyle(0x9932cc);
                powerup.fillRect(2, 2, 12, 12);
                powerup.fillStyle(0xffffff);
                powerup.fillRect(6, 6, 4, 4);
                powerup.fillRect(4, 8, 2, 2);
                powerup.fillRect(10, 4, 2, 2);
                powerup.generateTexture("powerup", 16, 16);
                powerup.destroy();

                // Portal texture
                const portal = this.add.graphics();
                portal.fillStyle(0x00ff00);
                portal.fillRect(0, 0, 40, GAME_HEIGHT);
                portal.generateTexture("portal", 40, GAME_HEIGHT);
                portal.destroy();

                // Particle texture
                const particle = this.add.graphics();
                particle.fillStyle(0xffffff);
                particle.fillRect(0, 0, 4, 4);
                particle.generateTexture("particle", 4, 4);
                particle.destroy();

                // Portal particle texture
                const portalParticle = this.add.graphics();
                portalParticle.fillStyle(0x00ff00);
                portalParticle.fillRect(0, 0, 3, 3);
                portalParticle.generateTexture("portal_particle", 3, 3);
                portalParticle.destroy();
            }

            // === AUDIO SETUP ===
            setupAudio() {
                this.audioContext = null;
                this.audioInitialized = false;
                this.sounds = {};
                
                // Initialize audio context on first user interaction
                this.input.once('pointerdown', this.initializeAudio, this);
                this.input.keyboard.once('keydown', this.initializeAudio, this);
            }

            initializeAudio() {
                if (this.audioInitialized) return;
                
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    this.audioInitialized = true;
                    console.log("Audio initialized successfully! üîä");
                } catch (error) {
                    console.warn("Audio not supported:", error);
                }
            }

            // === SOUND GENERATION ===
            playSound(type, frequency = 440, duration = 0.2, volume = 0.1) {
                if (!this.audioContext) return;
                
                try {
                    const oscillator = this.audioContext.createOscillator();
                    const gainNode = this.audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(this.audioContext.destination);
                    
                    // Different sound types
                    switch (type) {
                        case 'jump':
                            oscillator.type = 'square';
                            oscillator.frequency.setValueAtTime(300, this.audioContext.currentTime);
                            oscillator.frequency.exponentialRampToValueAtTime(500, this.audioContext.currentTime + 0.1);
                            break;
                        case 'coin':
                            oscillator.type = 'sine';
                            oscillator.frequency.setValueAtTime(523, this.audioContext.currentTime); // C5
                            oscillator.frequency.setValueAtTime(659, this.audioContext.currentTime + 0.1); // E5
                            oscillator.frequency.setValueAtTime(784, this.audioContext.currentTime + 0.2); // G5
                            break;
                        case 'powerup':
                            oscillator.type = 'sawtooth';
                            oscillator.frequency.setValueAtTime(200, this.audioContext.currentTime);
                            oscillator.frequency.exponentialRampToValueAtTime(800, this.audioContext.currentTime + 0.3);
                            duration = 0.4;
                            volume = 0.15;
                            break;
                        case 'portal':
                            oscillator.type = 'sine';
                            oscillator.frequency.setValueAtTime(100, this.audioContext.currentTime);
                            oscillator.frequency.exponentialRampToValueAtTime(1000, this.audioContext.currentTime + 0.5);
                            duration = 0.6;
                            volume = 0.12;
                            break;
                        case 'dimension':
                            oscillator.type = 'triangle';
                            oscillator.frequency.setValueAtTime(880, this.audioContext.currentTime);
                            oscillator.frequency.exponentialRampToValueAtTime(220, this.audioContext.currentTime + 0.3);
                            duration = 0.4;
                            volume = 0.08;
                            break;
                        default:
                            oscillator.type = 'sine';
                            oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                    }
                    
                    // Volume envelope
                    gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);
                    gainNode.gain.linearRampToValueAtTime(volume, this.audioContext.currentTime + 0.01);
                    gainNode.gain.exponentialRampToValueAtTime(0.001, this.audioContext.currentTime + duration);
                    
                    oscillator.start(this.audioContext.currentTime);
                    oscillator.stop(this.audioContext.currentTime + duration);
                } catch (error) {
                    console.warn("Error playing sound:", error);
                }
            }

            // === PHYSICS WORLD ===
            setupPhysicsWorld() {
                this.physics.world.setBounds(0, 0, WORLD_WIDTH, GAME_HEIGHT);
            }

            // === BACKGROUND ===
            createBackground() {
                this.background = this.add.rectangle(
                    WORLD_WIDTH / 2,
                    GAME_HEIGHT / 2,
                    WORLD_WIDTH,
                    GAME_HEIGHT,
                    0x87ceeb
                );
                this.background.setScrollFactor(0.1);
            }

            // === PLAYER ===
            createPlayer() {
                this.player = this.physics.add.sprite(PLAYER_START_X, PLAYER_START_Y, "player_light");
                this.player.setBounce(0);
                this.player.setCollideWorldBounds(true);
                this.player.jumpState = "none";
                this.player.animationState = "standing";
            }

            // === GROUPS ===
            createGroups() {
                this.platforms = this.physics.add.staticGroup();
                this.collectibles = this.physics.add.group();
                this.hazards = this.add.group();
                this.powerups = this.physics.add.group();
            }

            // === PARTICLES ===
            createParticles() {
                this.particles = this.add.particles(0, 0, "particle", {
                    speed: { min: 50, max: 150 },
                    scale: { start: 1, end: 0 },
                    lifespan: 600,
                    emitting: false,
                });

                // Portal particles for portal effect
                this.portalParticles = this.add.particles(0, 0, "portal_particle", {
                    speed: { min: 40, max: 100 },
                    angle: { min: 0, max: 360 },
                    scale: { start: 1, end: 0 },
                    lifespan: 800,
                    emitting: false,
                    quantity: 2,
                    frequency: 100,
                    alpha: { start: 1, end: 0 },
                    blendMode: 'ADD',
                });
            }

            // === UI ===
            createUI() {
                this.scoreText = this.add.text(16, 16, "Score: 0", { fontSize: "18px", fill: "#fff" }).setScrollFactor(0);
                this.livesText = this.add.text(16, 40, "Lives: 3", { fontSize: "18px", fill: "#fff" }).setScrollFactor(0);
                this.dimensionText = this.add.text(16, 64, "Dimension: Light", { fontSize: "18px", fill: "#5f5fff" }).setScrollFactor(0);
                this.levelText = this.add.text(GAME_WIDTH - 120, 16, "Level: 1", { fontSize: "18px", fill: "#fff" }).setScrollFactor(0);
            }

            // === INPUT ===
            setupInput() {
                this.cursors = this.input.keyboard.createCursorKeys();
                this.spaceKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);
                this.wasd = this.input.keyboard.addKeys("W,S,A,D");
            }

            // === CAMERA ===
            setupCamera() {
                this.cameras.main.setBounds(0, 0, WORLD_WIDTH, GAME_HEIGHT);
                this.cameras.main.startFollow(this.player, true, 0.08, 0.08);
            }

            // === LEVEL GENERATION ===
            generateLevel() {
                this.clearLevel();
                this.player.setPosition(PLAYER_START_X, PLAYER_START_Y);
                this.player.setVelocity(0, 0);
                this.levelTransitioning = false;
                this.createStartingPlatforms();
                this.generatePlatforms();
                this.createPortal();
                this.physics.add.collider(this.player, this.platforms);

                // Add physics interactions for collectibles and powerups
                this.physics.add.collider(this.collectibles, this.platforms);
                this.physics.add.collider(this.powerups, this.platforms);
                this.physics.add.overlap(this.player, this.collectibles, this.collectCoin, null, this);
                this.physics.add.overlap(this.player, this.powerups, this.collectPowerup, null, this);
            }

            clearLevel() {
                this.platforms.clear(true, true);
                this.collectibles.clear(true, true);
                this.hazards.clear(true, true);
                this.powerups.clear(true, true);
                if (this.portal) {
                    this.portal.destroy();
                    this.portal = null;
                }
            }

            createStartingPlatforms() {
                for (let x = 0; x < 100; x += PLATFORM_WIDTH) {
                    const platform = this.platforms.create(x, 250, "platform_light");
                    platform.dimension = 2;
                    platform.refreshBody();
                }
            }

            generatePlatforms() {
                const startX = 150;
                const endX = WORLD_WIDTH - 200;
                const platformSpacing = 180;
                let currentX = startX;

                while (currentX < endX) {
                    const platformY = 200 + Math.sin(currentX / 300) * 80;
                    const clampedY = Phaser.Math.Clamp(platformY, 80, GAME_HEIGHT - 80);

                    const platformWidth = 80;
                    const platformCount = Math.ceil(platformWidth / 16);
                    for (let j = 0; j < platformCount; j++) {
                        const platform = this.platforms.create(
                            currentX + j * 16,
                            clampedY,
                            "platform_light"
                        );
                        platform.dimension = 0;
                        platform.refreshBody();
                    }

                    // Spawn collectibles and powerups on some platforms
                    this.spawnCollectiblesAndPowerups(currentX + platformWidth / 2, clampedY);

                    currentX += platformSpacing;
                }
            }

            // === COLLECTIBLES AND POWERUPS SPAWNING ===
            spawnCollectiblesAndPowerups(x, platformY) {
                // 60% chance to spawn a coin above the platform
                if (Math.random() < 0.6) {
                    const coin = this.physics.add.sprite(x, platformY - 30, "coin");
                    coin.setBounce(0.3);
                    coin.setCollideWorldBounds(true);
                    coin.body.setGravityY(200);
                    this.collectibles.add(coin);
                }

                // 15% chance to spawn a powerup above the platform
                if (Math.random() < 0.15) {
                    const powerup = this.physics.add.sprite(x + 20, platformY - 30, "powerup");
                    powerup.setBounce(0.2);
                    powerup.setCollideWorldBounds(true);
                    powerup.body.setGravityY(150);
                    this.powerups.add(powerup);
                }
            }

            createPortal() {
                this.portal = this.add.sprite(WORLD_WIDTH - 60, GAME_HEIGHT / 2, "portal");
                this.portal.setOrigin(0.5, 0.5);

                // Start portal particles
                this.portalParticles.setPosition(WORLD_WIDTH - 60, GAME_HEIGHT / 2);
                this.portalParticles.start();
            }

            // === COLLISION HANDLERS ===
            collectCoin(player, coin) {
                // Add sparkle effect at coin position
                this.particles.setPosition(coin.x, coin.y);
                this.particles.explode(10);

                // Remove the coin
                coin.destroy();

                // Play coin sound
                this.playSound('coin');

                // Add points (could be tracked in a score system)
                console.log("Coin collected! ‚ú®");
            }

            collectPowerup(player, powerup) {
                // Add bigger sparkle effect at powerup position
                this.particles.setPosition(powerup.x, powerup.y);
                this.particles.explode(20);

                // Remove the powerup
                powerup.destroy();

                // Play powerup sound
                this.playSound('powerup');

                // Temporary speed boost
                this.currentPlayerSpeed = 220;
                this.currentJumpVelocity = 380;

                // Reset speed after 5 seconds
                this.time.delayedCall(5000, () => {
                    this.currentPlayerSpeed = PLAYER_SPEED;
                    this.currentJumpVelocity = JUMP_VELOCITY;
                });

                console.log("Powerup collected! Speed boost activated! üöÄ");
            }

            // === GAME LOOP ===
            update() {
                if (!this.player || !this.player.body) return;
                this.handlePlayerMovement();
                this.handlePlayerJump();
                this.handleDimensionShift();
                this.handleCollisions();
                this.updateUI();
            }

            handlePlayerMovement() {
                if (this.cursors.left.isDown || this.wasd.A.isDown || this.mobileInput.left) {
                    this.player.setVelocityX(-this.currentPlayerSpeed);
                } else if (this.cursors.right.isDown || this.wasd.D.isDown || this.mobileInput.right) {
                    this.player.setVelocityX(this.currentPlayerSpeed);
                } else {
                    this.player.setVelocityX(0);
                }
            }

            handlePlayerJump() {
                const isOnGround = this.player.body.touching.down;
                if ((this.cursors.up.isDown || this.wasd.W.isDown) && isOnGround) {
                    this.player.setVelocityY(-this.currentJumpVelocity);
                    this.player.jumpState = "rising";
                    this.playSound('jump'); // Play jump sound
                }
            }

            handleDimensionShift() {
                if (Phaser.Input.Keyboard.JustDown(this.spaceKey)) {
                    this.dimension = 1 - this.dimension;
                    this.dimensionText.setText(
                        "Dimension: " + (this.dimension === 0 ? "Light" : "Dark")
                    );
                    this.dimensionText.setFill(
                        this.dimension === 0 ? "#5f5fff" : "#ff5f5f"
                    );
                    this.particles.emitParticleAt(this.player.x, this.player.y, 20);
                    
                    // Play dimension shift sound
                    this.playSound('dimension');
                }
            }

            handleCollisions() {
                // Death check
                if (this.player.y > GAME_HEIGHT - 10) {
                    this.lives--;
                    this.player.setPosition(PLAYER_START_X, PLAYER_START_Y);
                    this.player.setVelocity(0, 0);
                    if (this.lives <= 0) {
                        this.gameOver();
                    }
                    return;
                }

                // Portal collision
                if (
                    this.portal &&
                    this.portal.visible &&
                    !this.levelTransitioning &&
                    Phaser.Geom.Intersects.RectangleToRectangle(
                        this.player.getBounds(),
                        this.portal.getBounds()
                    )
                ) {
                    this.levelTransitioning = true;
                    this.playSound('portal'); // Play portal sound
                    this.nextLevel();
                }
            }

            updateUI() {
                this.scoreText.setText("Score: " + this.score);
                this.livesText.setText("Lives: " + this.lives);
                this.levelText.setText("Level: " + this.level);
            }

            // === LEVEL COMPLETION ===
            nextLevel() {
                this.level++;
                this.lives++;

                const overlay = this.add
                    .rectangle(0, 0, GAME_WIDTH, GAME_HEIGHT, 0x000000, 0.7)
                    .setOrigin(0)
                    .setScrollFactor(0);

                const levelText = this.add
                    .text(
                        GAME_WIDTH / 2,
                        GAME_HEIGHT / 2 - 20,
                        `Level ${this.level - 1} Complete!`,
                        { fontSize: "24px", fill: "#ffffff" }
                    )
                    .setOrigin(0.5)
                    .setScrollFactor(0);

                this.time.delayedCall(2000, () => {
                    overlay.destroy();
                    levelText.destroy();
                    this.generateLevel();
                });
            }

            // === GAME OVER ===
            gameOver() {
                this.physics.pause();

                const gameOverText = this.add
                    .text(GAME_WIDTH / 2, GAME_HEIGHT / 2, "GAME OVER", {
                        fontSize: "32px",
                        fill: "#ff0000",
                    })
                    .setOrigin(0.5)
                    .setScrollFactor(0);

                const finalScoreText = this.add
                    .text(
                        GAME_WIDTH / 2,
                        GAME_HEIGHT / 2 + 40,
                        "Final Score: " + this.score,
                        { fontSize: "24px", fill: "#fff" }
                    )
                    .setOrigin(0.5)
                    .setScrollFactor(0);

                const restartText = this.add
                    .text(
                        GAME_WIDTH / 2,
                        GAME_HEIGHT / 2 + 80,
                        "Click to restart",
                        { fontSize: "18px", fill: "#fff" }
                    )
                    .setOrigin(0.5)
                    .setScrollFactor(0);

                this.input.once("pointerdown", () => {
                    this.scene.restart();
                });
            }
        }

        // === PHASER GAME CONFIG ===
        const config = {
            type: Phaser.AUTO,
            width: window.innerWidth,
            height: window.innerHeight,
            parent: 'game-container',
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: GRAVITY },
                    debug: false
                }
            },
            scene: QuantumJumper,
            backgroundColor: '#87CEEB',
            scale: {
                mode: Phaser.Scale.RESIZE,
                autoCenter: Phaser.Scale.CENTER_BOTH
            },
            render: {
                antialias: false,
                pixelArt: true
            }
        };
        const game = new Phaser.Game(config);
    </script>
</body>

</html>